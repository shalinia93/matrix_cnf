#!/bin/csh
#
# Generated by CHARMM-GUI (http://www.charmm-gui.org)

# This folder contains a pre-optimized PDB structure and OpenMM inputs.
# All input files were optimized for OpenMM v6.2 or above, so lower version of OpenMM can cause some errors.
# You can get the latest development version of OpenMM at the git repository:
# https://github.com/pandegroup/openmm


# The OpenMM check point file (.chk) cannot be used in a different machine environment.
# So please make sure if you are using the same GPU and CUDA version of machine while doing additional
# production steps with the check point file.

set init   = step3_charmm2omm
set wca    = step4_wca
set equi   = step4_equilibration
set nvt    = step4_nvt # optional

# vacuum layer along Z?
set zlayer = `grep "set zlayer" ../step2.1_size.str | awk '{print $4}'`
if ($zlayer > 0) then
    python -u openmm_run.py -i ${nvt}.inp -t toppar.str -p ${init}.psf -c ${init}.crd -b ${init}.str -orst ${nvt}.rst -odcd ${nvt}.dcd -opdb ${nvt}.pdb -ostr ${nvt}.str -zlayer $zlayer > ${nvt}.out
else
    # WCA
    python -u openmm_run.py -i ${equi}.inp -t toppar.str -p ${init}.psf -c ${init}.crd -b ${init}.str -orst ${wca}.rst -odcd ${wca}.dcd -opdb ${wca}.pdb -wca > ${wca}.out
    # Normal equilibration
    python -u openmm_run.py -i ${equi}.inp -t toppar.str -p ${init}.psf -c ${init}.crd -irst ${wca}.rst -orst ${equi}.rst -odcd ${equi}.dcd -opdb ${equi}.pdb -ostr ${equi}.str > ${equi}.out
endif
